<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <title>game-shop</title>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/nprogress.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="css/font-awesome.min.css">
    <link rel="apple-touch-icon-precomposed" href="images/icon.png">
    <link href="css/styleBBS.css" rel="stylesheet" type="text/css" />
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="js/jquery-2.1.4.min.js"></script>
    <script src="js/nprogress.js"></script>
    <script src="js/jquery.lazyload.min.js"></script>
    <!-- axios请求处理JS-->
    <script src="js/axios.js"></script>
</head>
<body class="user-select">
    <header class="header">
        <nav class="navbar navbar-default" id="navbar">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#header-navbar" aria-expanded="false"> <span class="sr-only"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button>
                    <h1 class="logo hvr-bounce-in"><a href="./index.html" title="游戏商城"><img src="./images/YTlogo.jpg" alt="游戏商城" style="width: 16%;height: 20%"></a></h1>
                </div>
                <div class="collapse navbar-collapse" id="header-navbar">
                    <ul id="info" class="nav navbar-nav navbar-right" style="position: relative;bottom: -20px">
                        <li id="signIn"><a data-cont="登录" title="登录" data-toggle="modal" data-target="#myModal">登录</a></li>
                        <li id="signUp"><a data-cont="注册" title="注册" data-toggle="modal" data-target="#register">注册</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <section class="container">
        <div class="content-wrap">
            <div class="content">
                <div id="lunbotu" class="carousel slide" data-ride="carousel">
                    <ol class="carousel-indicators">
                        <li data-target="#lunbotu" data-slide-to="0" class="active"></li>
                        <li data-target="#lunbotu" data-slide-to="1"></li>
                    </ol>
                </div>
                <div id="content1"></div>
                <nav class="pagination" style="display: block;">
                </nav>
                <div id="tabulation">
                    <dl>
                        <dt style="height: 40px"><h1>游戏商城BBS</h1><font>/sifu/</font></dt>
                    </dl>
                    <ul id="replyList">
                    </ul>
                    <button class="btn btn-default" style="position: relative;left: 720px;background: #a1d5e8;" data-toggle="modal" data-target="#myModal3">发帖 </button>
                </div>
            </div>
        </div>
        <aside class="sidebar">
            <div class="widget widget_hot">
                <h3>最新游戏</h3>
                <ul id="ulList">
                </ul>
            </div>
            <div class="widget widget_sentence">
                <h3>友情链接</h3>
                <div class="widget-sentence-content">
                    <a href="http://www.4399.com/" title="Harries BLOG" target="_blank" draggable="false">4399小游戏</a>&nbsp;&nbsp;&nbsp;
                </div>
                <div class="widget-sentence-content">
                    <a href="http://www.4399.com/" title="Harries BLOG" target="_blank" draggable="false">大连东软</a>&nbsp;&nbsp;&nbsp;
                </div>
            </div>
        </aside>
    </section>
    <footer class="footer">
        <div class="container">
            <p>本站[<a href="">简简单单游戏</a>]的部分内容来源于网络，若侵犯到您的利益，请联系站长删除！谢谢！Powered By [<a href="" target="_blank" rel="nofollow">DTcms</a>] Version 4.0 &nbsp;<a href="" target="_blank" rel="nofollow">快快乐乐</a> &nbsp; <a href="" target="_blank" class="sitemap">网站地图</a></p>

        </div>
        <div id="gotop"><a class="gotop"></a></div>
    </footer>

    <!-- 发帖 -->
    <div class="modal fade" id="myModal3">
        <div class="modal-dialog">
            <div class="modal-content">
                <!-- 模态框头部 -->
                <div class="modal-header">
                    <h4 class="modal-title">bbs</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <!-- 模态框主体 -->
                <div class="modal-body" >
                    <form role="form"  method="get">
                        <div class="form-group">
                            <label >题目</label>
                            <input type="text" class="form-control" id="title" placeholder="请输入标题">
                        </div>
                        <div class="form-group">
                            <label >内容</label>
                            <input type="text" class="form-control" id="bbsContent" placeholder="请输入内容">
                        </div>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="publish()">发布</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- 登录 -->
    <div class="modal fade" id="myModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <!-- 模态框头部 -->
                <div class="modal-header">
                    <h4 class="modal-title">登录</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <!-- 模态框主体 -->
                <div class="modal-body" >
                    <form role="form"  method="get">
                        <div class="form-group">
                            <label >电话</label>
                            <input type="text" class="form-control" id="user_phone" placeholder="请输入电话">
                        </div>
                        <div class="form-group">
                            <label >密码</label>
                            <input type="text" class="form-control" id="user_password" placeholder="请输入密码">
                        </div>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="signIn()">登录</button>
                    </form>
                </div>
            </div>
        </div>
    </div>


    <!-- 注册 -->
    <div class="modal fade" id="register">
        <div class="modal-dialog">
            <div class="modal-content">
                <!-- 模态框头部 -->
                <div class="modal-header">
                    <h4 class="modal-title">注册</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <!-- 模态框主体 -->
                <div class="modal-body">
                        <div class="form-group">
                            <label >电话</label>
                            <input type="text" class="form-control" id="rPhone" placeholder="请输入电话">
                        </div>
                        <div class="form-group">
                            <label >密码</label>
                            <input type="text" class="form-control" id="rPassword" placeholder="请输入密码">
                        </div>
                        <div class="form-group">
                            <label >姓名</label>
                            <input type="text" class="form-control" id="rName" placeholder="姓名">
                        </div>
                        <div class="form-group">
                            <label >标签</label>
                            <select id="selects">
                                <option value =1>程序员</option>
                                <option value =2>设计师</option>
                                <option value=3>工程师</option>
                                <option value=4>普通人</option>
                            </select>
                        </div>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="signUp()">注册</button>
                </div>
            </div>
        </div>
    </div>



    <!-- axios请求处理JS-->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.ias.js"></script>
    <script src="js/scripts.js"></script>
    <!-- axios请求处理JS-->
    <script src="js/axios.js"></script>
    <script>

        //获取广告图
        axios({
            method:"get",
            url:"http://localhost:8081/poster/list"
        }).then(res=>getAdvertisement(res))

        function getAdvertisement(res) {
           const json = res.data.data
                document.getElementById('lunbotu').innerHTML ='   <div class="carousel-inner" role="listbox" id="carousel-inner-1">\n' +
                    '<div class="item active">\n' +
                    '<img src=' +json[0].image+
                    ' alt="广告1" class="img-responsive">\n' +
                    '</a>\n' +
                    '</div>\n' +
                    '<div class="item">\n' +
                    '<img src=' +json[1].image+
                    ' alt="广告2" class="img-responsive">\n' +
                    '</a>\n' +
                    '</div>\n' +
                    '</div>\n' +
                    '<a class="left carousel-control" href="#lunbotu" role="button" data-slide="prev" rel="nofollow">\n' +
                    '<span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>\n' +
                    '<a class="right carousel-control" href="#lunbotu" role="button" data-slide="next" rel="nofollow">\n' +
                    '<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>  </a>'
        }

        //获取所有游戏列表
        axios({
            method:"get",
            url:"http://localhost:8081/game/list"
        }).then(res=>getGameList(res))
        function getGameList(res){
            const json = res.data.data
            var content = ''
            for (let i in json) {
                content +=
                    '               <article class="excerpt excerpt-1">\n' +
                    '                    <a onclick="toGamePage(' + json[i].gameId + ')" class="focus" title=' +json[i].gameName+
                    '                       ><img class="thumb" data-original=' +json[i].gameUrl+ ' src=' +json[i].gameUrl+ ' draggable="false" style="display: inline;"></a>\n' +
                    '                    <header>\n' +
                    '                        <h2>\n' +
                    '                            <a onclick="toGamePage(' + json[i].gameId + ')" title=' +json[i].gameName+
                    '                                target="_blank" draggable="false">' +json[i].gameName+
                    '                               </a>\n' +
                    '                        </h2>\n' +
                    '                    </header>\n' +
                    '                    <p class="meta">\n' +
                    '                        <time class="time">' +timeFormat(json[i].createTime)+
                    '                        </time>\n' +
                    '                    </p>\n' +json[i].content +
                    '                </article>'
            }
            document.getElementById('content1').innerHTML =content
        }

        //获取论坛评论列表
        axios({
            method:"get",
            url:"http://localhost:8081/ytPost/list"
        }).then(res=>{
            const json = res.data.data
            if(json==null)return;
            var content = ''
            for (let i in json) {
                content += '<li style="height: 40px"><a onclick="toPostPage(' +  json[i].id + ')">' + json[i].title + '</a><font>' + timeFormat(json[i].cTime) +
                    '</font><u></u><i>' + json[i].content + '</i></li>'
            }
            document.getElementById('replyList').innerHTML =content
        })

        function toPostPage(id){
            const url = "./postPage.html?id="+id;
            window.open(url)
        }


        //获取所有游戏列表 按照时间排序，只拿前三条
        axios({
            method:"get",
            url:"http://localhost:8081/game/listTime"
        }).then(res=>getGameListByTime(res))
        function getGameListByTime(res) {
            const json = res.data.data
            var content = ''
            for (let i in json) {
                content +=
                    '                  <li>\n' +
                    '                        <a onclick="toGamePage(' + json[i].gameId + ')" title= ' +json[i].gameName+ '>\n' +
                    '                            <span class="thumbnail">\n' +
                    '                                <img class="thumb" data-original= ' + json[i].gameUrl + ' src=' + json[i].gameUrl + '>\n' +
                    '                            </span><span class="text">' + json[i].gameName + '<br>' +
                    '                                <i class="glyphicon glyphicon-time"></i>\n' +timeFormat(json[i].createTime)+
                    '                            </span>\n' +
                    '                        </a>\n' +
                    '                    </li>'
            }
            document.getElementById('ulList').innerHTML =content
        }

        //登录
        function signIn() {
           const phone = document.getElementById('user_phone').value
           const password = document.getElementById('user_password').value
            axios({
                method:"post",
                url:"http://localhost:8081/user/login",
                data :{
                    userPhone : phone,
                    userPassword : password
                }
            }).then(res=>{
                const json = res.data.data
               if(json==null){
                   alert("登录失败")
               }
               else {
                   //用户信息存起来
                   localStorage.setItem("user",json.userId)
                   console.log(localStorage.getItem("user"))
                   document.getElementById("signUp").remove()
                   document.getElementById("signIn").remove()
                   document.getElementById("info").innerHTML = '<a style="font-size: 20px" onclick="userInfo()">' +
                       json.userName+'</a>'+
                       '<span>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</span>'+
                       '<a style="font-size: 20px"  onclick="toOrderPage()">' +"我的订单"+'</a>'
               }
            })
        }

        //注册
        function signUp() {
            const phone = document.getElementById('rPhone').value
            const password = document.getElementById('rPassword').value
            const target = document.getElementById('selects').value
            const name = document.getElementById('rName').value
            axios({
                method:"post",
                url:"http://localhost:8081/user/signUp",
                data :{
                    userPhone : phone,
                    userPassword : password,
                    type:1,
                    target:target,
                    userName:name
                }
            }).then(res=>{
                const json = res.data.data
                if(json==null){
                    alert("注册失败")
                }
                else {
                    alert("注册成功")
                }
            })
        }

        //发布
        function publish() {
            if(localStorage.getItem("user")==null){
                console.log(2323)
                alert("请登录")
                return
            }
            const title = document.getElementById('title').value
            const bbsContent = document.getElementById('bbsContent').value
            axios({
                method:"post",
                url:"http://localhost:8081/ytPost/add",
                data :{
                    title : title,
                    content : bbsContent,
                    userId:localStorage.getItem("user")
                }
            }).then(res=>{
                const json = res.data.data
                if(json==null){
                    alert("发布失败")
                }
                else {
                    alert("发布成功")
                }
            })
        }


        //跳转到game详情页
        function toGamePage(id) {
            const url = "./show.html?id="+id;
            window.open(url)
        }

        //跳转到订单详情页
        function toOrderPage() {
            window.open("./order.html")
        }



        //跳转到info页
        function userInfo() {
            window.open("./info.html")
        }





        /**
         * 将"2018-05-19T08:04:52.000+0000"这种格式的时间转化为正常格式
         * @param time
         */
        function timeFormat(time) {
            var d = new Date(time);

            var year = d.getFullYear();       //年
            var month = d.getMonth() + 1;     //月
            var day = d.getDate();            //日

            var hh = d.getHours();            //时
            var mm = d.getMinutes();          //分
            var ss = d.getSeconds();           //秒

            var clock = year + "/";

            if (month < 10)
                clock += "0";

            clock += month + "/";

            if (day < 10)
                clock += "0";

            clock += day + " ";

            if (hh < 10)
                clock += "0";

            clock += hh + ":";
            if (mm < 10) clock += '0';
            clock += mm + ":";

            if (ss < 10) clock += '0';
            clock += ss;
            return (clock);
        }
    </script>
</body>
</html>
